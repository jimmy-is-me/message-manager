# LINE官方帳號訊息管理系統

![Version](https://img.shields.io/badge/version-1.2.0-blue)
![WordPress](https://img.shields.io/badge/WordPress-5.0%2B-blue)
![PHP](https://img.shields.io/badge/PHP-7.2%2B-blue)
![License](https://img.shields.io/badge/license-GPL--2.0-green)

一個功能完整的WordPress插件，提供前台客服對話框和後台訊息管理系統，並整合Discord通知功能。

## 🎬 功能展示

### 前台對話框（LINE風格）
- 🎨 漸層綠色標題列
- 📧 首次使用必須輸入Email
- 😊 完整表情符號支援（6大分類，144+ emoji）
- 💬 即時訊息發送與接收
- 📱 完美響應式設計

### 後台管理系統
- 📊 對話列表與即時未讀提示
- 🔍 全文搜尋功能（搜尋姓名、Email、電話、訊息內容）
- ⚡ 快速回覆範本系統
- 💬 對話歷史記錄
- 🎯 客戶資訊完整顯示

### Discord整合
- 🔔 新訊息即時通知
- 📝 顯示完整客戶資訊
- 🔗 直接連結到後台管理

## 🌟 功能特色

### 核心功能
- ✅ **前台對話框** - 網站訪客可以透過對話框發送問題
- ✅ **後台管理** - 管理員可以在WordPress後台查看和回覆所有訊息
- ✅ **Discord通知** - 有新訊息時自動發送Discord通知
- ✅ **對話追蹤** - 自動追蹤每個客戶的對話記錄
- ✅ **浮動視窗** - 對話框以浮動視窗形式顯示在網站右下角
- ✅ **短代碼支援** - 可在任何頁面或文章中嵌入對話框

### v1.2.0 新功能 🆕
- ✅ **表情符號支援** - 6大分類（笑臉、手勢、愛心、物品、符號、自然），144+ emoji
- ✅ **快速回覆範本** - 預設5個範本，支援自訂與快捷指令
- ✅ **訊息搜尋** - 搜尋客戶姓名、Email、電話或訊息內容
- ✅ **Email必填** - 首次使用強制輸入Email，並儲存供下次使用
- ✅ **UI優化** - LINE風格設計，漸層標題，流暢動畫效果

### 使用者體驗
- ✅ **響應式設計** - 完美支援桌面和行動裝置
- ✅ **即時更新** - 自動檢查新回覆（每3秒輪詢）
- ✅ **客戶資訊收集** - Email必填，姓名/電話可選
- ✅ **未讀提示** - 顯示未讀訊息數量
- ✅ **流暢動畫** - 訊息彈跳、按鈕脈衝、輸入框光暈等效果

## 📋 系統需求

- WordPress 5.0 或更高版本
- PHP 7.2 或更高版本
- MySQL 5.6 或更高版本

## 🚀 安裝步驟

### 方法一：透過WordPress後台安裝

1. 下載插件ZIP檔案
2. 登入WordPress後台
3. 前往 **插件 → 安裝插件 → 上傳插件**
4. 選擇下載的ZIP檔案並上傳
5. 點擊**立即安裝**
6. 安裝完成後，點擊**啟用插件**

### 方法二：FTP上傳安裝

1. 解壓縮下載的ZIP檔案
2. 將 `line-message-manager` 資料夾上傳到 `/wp-content/plugins/` 目錄
3. 登入WordPress後台
4. 前往 **插件 → 已安裝的插件**
5. 找到「LINE官方帳號訊息管理系統」並點擊**啟用**

## ⚙️ 設定說明

### 1. Discord通知設定

1. 前往 **LINE訊息 → 設定**
2. 在Discord設定區塊中：
   - 輸入您的Discord Webhook URL
   - 勾選「啟用Discord通知」
3. 點擊**測試連接**按鈕確認設定正確
4. 點擊**儲存設定**

#### 如何取得Discord Webhook URL？

1. 開啟Discord並選擇要接收通知的頻道
2. 點擊頻道名稱旁的齒輪圖示（編輯頻道）
3. 選擇左側選單的「整合」
4. 點擊「Webhooks」
5. 點擊「新增Webhook」
6. 設定Webhook名稱和圖示（可選）
7. 點擊「複製Webhook URL」
8. 將URL貼到插件設定頁面中

### 2. 前台對話框設定

在 **LINE訊息 → 設定** 頁面中，您可以自訂：

- **對話框標題** - 顯示在對話框頂部的標題文字
- **訊息輸入提示文字** - 輸入框的placeholder文字
- **必填欄位** - 選擇是否要求客戶提供姓名、Email、電話
- **對話框位置** - 選擇浮動視窗顯示在右下角或左下角
- **主題顏色** - 自訂對話框的主色調（預設為LINE綠色 #06c755）

### 3. 使用短代碼嵌入對話框

在任何頁面、文章或小工具中使用以下短代碼：

```
[line_message_chat]
```

這會在該位置嵌入一個完整的對話框介面。

**注意：** 除了短代碼，插件會自動在網站上添加浮動對話框按鈕。

## 📱 使用說明

### 客戶端使用流程

1. 訪客進入網站後，會在右下角（或左下角）看到對話框按鈕
2. 點擊按鈕開啟對話框
3. 首次使用時，需要填寫基本資訊（根據設定而定）
4. 輸入問題並發送
5. 系統會自動追蹤對話，客戶可以看到管理員的回覆

### 管理員使用流程

1. 登入WordPress後台
2. 前往 **LINE訊息 → 所有對話**
3. 查看所有對話列表，未讀訊息會以黃色背景標示
4. 點擊任一對話查看完整訊息記錄
5. 在底部的回覆框中輸入回覆內容
6. 點擊**發送回覆**

### Discord通知

當有新訊息時，Discord會收到包含以下資訊的通知：
- 客戶姓名
- 聯絡方式（Email/電話）
- 訊息內容
- 對話ID
- 直接連結到後台管理頁面的按鈕

## 🎨 自訂樣式

如果您想進一步自訂對話框的外觀，可以在您的佈景主題中添加自訂CSS：

```css
/* 修改主題顏色 */
:root {
    --lmm-primary-color: #your-color;
}

/* 修改對話框大小 */
.lmm-chat-window {
    width: 400px;
    height: 650px;
}

/* 修改按鈕樣式 */
.lmm-chat-toggle {
    width: 70px;
    height: 70px;
}
```

## 🗄️ 資料庫結構

插件會建立以下資料表：

### wp_lmm_messages

儲存所有訊息記錄，包含：
- 對話ID（conversation_id）
- 客戶資訊（姓名、Email、電話）
- 訊息類型（客戶/管理員）
- 訊息內容
- 狀態（未讀/已讀/已回覆）
- IP地址和User Agent
- 時間戳記

## 🔒 安全性

- 所有AJAX請求都使用WordPress nonce驗證
- 所有輸入都經過sanitize處理
- SQL查詢使用prepared statements防止SQL注入
- 管理功能需要 `manage_options` 權限

## 🐛 問題排解

### Discord通知無法發送

1. 確認Webhook URL是否正確
2. 使用「測試連接」按鈕檢查連接狀態
3. 確認已勾選「啟用Discord通知」
4. 檢查Discord頻道的權限設定

### 對話框沒有顯示

1. 確認插件已啟用
2. 清除瀏覽器快取
3. 檢查是否有JavaScript錯誤（開啟瀏覽器開發者工具）
4. 確認沒有其他插件或佈景主題衝突

### 訊息無法發送

1. 檢查必填欄位是否都已填寫
2. 確認WordPress的AJAX功能正常運作
3. 查看瀏覽器控制台是否有錯誤訊息
4. 檢查伺服器的PHP錯誤日誌

## 📝 更新日誌

### 版本 1.0.0 (2026-01-17)

- 🎉 首次發布
- ✅ 前台對話框功能
- ✅ 後台訊息管理
- ✅ Discord通知整合
- ✅ 響應式設計
- ✅ 短代碼支援

## 💡 常見問題 (FAQ)

**Q: 這個插件需要LINE官方帳號嗎？**
A: 不需要！這個插件是獨立的客服系統，不需要串接LINE API。名稱中的「LINE」是指提供類似LINE的對話體驗。

**Q: 客戶需要登入才能發送訊息嗎？**
A: 不需要，訪客無需登入即可發送訊息。

**Q: 訊息是即時的嗎？**
A: 前台會每3秒自動檢查新回覆，接近即時的體驗。Discord通知是即時發送的。

**Q: 可以匯出訊息記錄嗎？**
A: 目前版本暫不支援匯出功能，未來版本會考慮加入。

**Q: 支援多語言嗎？**
A: 目前僅支援繁體中文，未來會考慮加入多語言支援。

**Q: 可以在多個網站使用嗎？**
A: 可以，每個WordPress網站獨立安裝即可。

## 📞 技術支援

如有任何問題或建議，請聯繫：

- Email: support@yourwebsite.com
- 網站: https://yourwebsite.com

## 📄 授權條款

GPL v2 或更高版本

## 👨‍💻 開發者

- 作者: Your Name
- 網站: https://yourwebsite.com
- 版本: 1.0.0

---

感謝您使用 LINE官方帳號訊息管理系統！
