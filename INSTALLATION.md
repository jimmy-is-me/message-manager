# 安裝與設定指南

本文檔提供詳細的安裝和初次設定步驟。

## 📦 安裝前準備

### 系統需求檢查

在安裝前，請確認您的主機環境符合以下需求：

- ✅ WordPress 5.0 或更高版本
- ✅ PHP 7.2 或更高版本
- ✅ MySQL 5.6 或更高版本
- ✅ 管理員權限

### 建議的主機設定

- PHP記憶體限制：至少 64MB（建議 128MB 或更高）
- PHP最大執行時間：至少 30 秒
- MySQL資料庫權限：CREATE TABLE, ALTER TABLE

## 🔧 安裝步驟

### 方法一：WordPress後台安裝（推薦）

1. **準備插件檔案**
   - 將整個 `line-message-manager` 資料夾壓縮成ZIP檔案
   - 確保ZIP檔案內的第一層就是 `line-message-manager` 資料夾

2. **上傳安裝**
   ```
   WordPress後台 → 插件 → 安裝插件 → 上傳插件
   ```
   - 選擇ZIP檔案
   - 點擊「立即安裝」
   - 等待安裝完成

3. **啟用插件**
   - 安裝完成後點擊「啟用插件」
   - 或前往「插件 → 已安裝的插件」手動啟用

### 方法二：FTP上傳安裝

1. **解壓縮檔案**
   - 解壓縮ZIP檔案到本地電腦
   - 確認資料夾結構正確

2. **上傳到主機**
   - 使用FTP客戶端（如FileZilla）連接到您的主機
   - 上傳 `line-message-manager` 資料夾到：
     ```
     /wp-content/plugins/
     ```

3. **設定權限**
   - 確認資料夾權限為 755
   - 檔案權限為 644

4. **啟用插件**
   - 登入WordPress後台
   - 前往「插件 → 已安裝的插件」
   - 找到「LINE官方帳號訊息管理系統」
   - 點擊「啟用」

### 方法三：WP-CLI安裝（進階）

```bash
# 進入WordPress根目錄
cd /path/to/wordpress

# 安裝插件
wp plugin install /path/to/line-message-manager.zip

# 啟用插件
wp plugin activate line-message-manager
```

## ⚙️ 初次設定

安裝並啟用插件後，請依照以下步驟進行設定：

### 步驟 1：檢查安裝

1. 前往 WordPress 後台
2. 側邊選單會出現「LINE訊息」項目
3. 點擊「LINE訊息」查看是否正常顯示

### 步驟 2：設定Discord通知（重要！）

1. **取得Discord Webhook URL**
   
   a. 開啟Discord應用程式或網頁版
   
   b. 選擇要接收通知的伺服器和頻道
   
   c. 點擊頻道名稱旁的齒輪圖示（頻道設定）
   
   d. 選擇「整合」→「Webhooks」
   
   e. 點擊「新增Webhook」
   
   f. 設定Webhook：
      - 名稱：LINE訊息通知（或任何您喜歡的名稱）
      - 圖示：可上傳自訂圖示（可選）
   
   g. 點擊「複製Webhook URL」

2. **在插件中設定Webhook**
   
   a. 前往 WordPress 後台：**LINE訊息 → 設定**
   
   b. 在「Discord通知設定」區塊：
      - 貼上剛才複製的Webhook URL
      - 勾選「啟用Discord通知」
   
   c. 點擊「測試連接」按鈕
   
   d. 確認Discord頻道收到測試訊息
   
   e. 點擊「儲存設定」

### 步驟 3：自訂前台對話框

1. 在「前台對話框設定」區塊中：

   **基本設定：**
   - 對話框標題：例如「線上客服」、「需要幫助嗎？」
   - 訊息輸入提示文字：例如「請輸入您的問題...」

   **必填欄位：**
   - 根據需求勾選要求客戶提供的資訊
   - 建議至少勾選「姓名」或「Email」其中一項

   **外觀設定：**
   - 對話框位置：選擇右下角或左下角
   - 主題顏色：點擊色彩選擇器選擇您喜歡的顏色

2. 點擊「儲存設定」

### 步驟 4：測試對話框功能

1. **前台測試**
   - 開啟您的網站首頁（使用無痕模式或登出）
   - 確認右下角出現對話框按鈕
   - 點擊按鈕開啟對話框
   - 填寫資訊並發送測試訊息

2. **檢查Discord通知**
   - 確認Discord頻道收到新訊息通知
   - 點擊通知中的「前往後台回覆」按鈕

3. **後台測試**
   - 登入WordPress後台
   - 前往「LINE訊息 → 所有對話」
   - 查看剛才的測試訊息
   - 點擊進入對話
   - 輸入回覆並發送

4. **檢查前台回覆**
   - 回到前台對話框
   - 等待幾秒鐘（系統會自動檢查新回覆）
   - 確認收到管理員的回覆

## 🎯 進階設定

### 在特定頁面嵌入對話框

除了浮動視窗，您可以使用短代碼在特定位置嵌入對話框：

1. 編輯頁面或文章
2. 在內容中加入短代碼：
   ```
   [line_message_chat]
   ```
3. 發布或更新頁面

### 自訂CSS樣式

如果您想修改對話框的外觀，可以在佈景主題的 `style.css` 或「自訂CSS」中加入：

```css
/* 修改主題顏色 */
:root {
    --lmm-primary-color: #ff6b6b; /* 改成紅色 */
}

/* 修改對話框尺寸 */
.lmm-chat-window {
    width: 420px;
    height: 700px;
}

/* 修改按鈕大小 */
.lmm-chat-toggle {
    width: 65px;
    height: 65px;
}

/* 修改訊息氣泡樣式 */
.lmm-message-bubble {
    border-radius: 12px;
}
```

### 停用浮動對話框

如果您只想使用短代碼方式，不想要浮動按鈕，可以加入以下CSS：

```css
.lmm-chat-widget {
    display: none !important;
}
```

## 🔍 驗證安裝

### 檢查資料表

確認資料庫中已建立必要的資料表：

```sql
SHOW TABLES LIKE 'wp_lmm_messages';
```

### 檢查檔案權限

確認以下目錄和檔案存在且權限正確：

```
wp-content/plugins/line-message-manager/
├── line-message-manager.php (644)
├── includes/ (755)
├── admin/ (755)
├── public/ (755)
└── README.md (644)
```

### 檢查JavaScript載入

1. 開啟網站前台
2. 按 F12 開啟開發者工具
3. 切換到「Network」或「網路」標籤
4. 刷新頁面
5. 搜尋 `frontend.js` 和 `frontend.css`
6. 確認檔案狀態為 200（成功載入）

## ❗ 常見安裝問題

### 問題 1：啟用後出現白屏

**可能原因：** PHP語法錯誤或記憶體不足

**解決方法：**
1. 檢查 PHP 版本是否符合需求
2. 增加 PHP 記憶體限制
3. 查看伺服器錯誤日誌

### 問題 2：選單沒有出現

**可能原因：** 權限不足或快取問題

**解決方法：**
1. 確認您使用管理員帳號登入
2. 清除瀏覽器快取
3. 重新整理頁面

### 問題 3：資料表建立失敗

**可能原因：** 資料庫權限不足

**解決方法：**
1. 確認WordPress資料庫使用者有 CREATE TABLE 權限
2. 手動執行SQL建立資料表（參考 `includes/class-database.php`）
3. 聯繫主機商檢查資料庫權限

### 問題 4：前台對話框沒有顯示

**可能原因：** JavaScript衝突或載入失敗

**解決方法：**
1. 檢查瀏覽器控制台是否有錯誤
2. 暫時停用其他插件測試
3. 切換到WordPress預設佈景主題測試
4. 清除所有快取（頁面快取、瀏覽器快取）

### 問題 5：Discord通知無法發送

**可能原因：** Webhook URL錯誤或伺服器防火牆阻擋

**解決方法：**
1. 確認Webhook URL完整且正確
2. 使用「測試連接」功能檢查
3. 聯繫主機商確認是否有阻擋Discord API
4. 檢查伺服器的 `allow_url_fopen` 設定

## 📞 需要協助？

如果您在安裝過程中遇到問題：

1. 📖 查看 [README.md](README.md) 中的問題排解章節
2. 🔍 檢查 WordPress 除錯日誌
3. 📧 聯繫技術支援：support@yourwebsite.com

## ✅ 安裝完成檢查清單

完成以下項目即代表安裝成功：

- [ ] 插件已成功啟用
- [ ] WordPress後台出現「LINE訊息」選單
- [ ] Discord Webhook 測試成功
- [ ] 前台對話框正常顯示
- [ ] 可以成功發送測試訊息
- [ ] 後台可以查看訊息
- [ ] 可以成功回覆訊息
- [ ] Discord通知正常運作
- [ ] 前台可以收到管理員回覆

恭喜您完成安裝！現在可以開始使用了！🎉
